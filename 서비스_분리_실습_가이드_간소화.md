# Pet Clinic ì„œë¹„ìŠ¤ ë¶„ë¦¬ ì‹¤ìŠµ ê°€ì´ë“œ (ê°„ì†Œí™”)
## ğŸ“‹ ì‹¤ìŠµ ëª©í‘œ: ëª¨ë†€ë¦¬ìŠ¤ì—ì„œ Customer Service ë¶„ë¦¬

---

## ğŸ¯ ì‹¤ìŠµ ê°œìš”

### ëª©í‘œ
**ì„œë¹„ìŠ¤ ë¶„ë¦¬ì—ë§Œ ì§‘ì¤‘**: ë³µì¡í•œ REST API ë³€í™˜ ì—†ì´, ê¸°ì¡´ Thymeleaf UIë¥¼ ìœ ì§€í•˜ë©´ì„œ ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬

### ìµœì¢… ì•„í‚¤í…ì²˜
```
Before (ëª¨ë†€ë¦¬ì‹):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Monolithic Pet Clinic         â”‚
â”‚        Port: 8080               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (ë¶„ë¦¬):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer Service â”‚  â”‚   Monolith      â”‚
â”‚   Port: 8081     â”‚  â”‚   Port: 8080    â”‚
â”‚ (Owner + Pet)    â”‚  â”‚ (Vet + Visit)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Phase 1: Customer Service ë¶„ë¦¬

### Step 1: í˜„ì¬ êµ¬ì¡° íŒŒì•…

**ë³µì‚¬í•  íŒŒì¼ ëª©ë¡:**
- Model: Owner.java, Pet.java, PetType.java + Base í´ë˜ìŠ¤ë“¤
- Repository: OwnerRepository.java, PetRepository.java  
- Controller: OwnerController.java, PetController.java, PetForm.java
- Service: PetFormValidator.java
- Templates: welcome.html, fragments/, management/, owners/, pets/ í´ë” ì „ì²´

### Step 2: ë””ë ‰í† ë¦¬ ìƒì„± ë° íŒŒì¼ ë³µì‚¬
ì•„ë˜ì²˜ëŸ¼ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ IDEì—ì„œ ë³µì‚¬+ë¶™ì—¬ë„£ê¸°í•´ë„ ë©ë‹ˆë‹¤!

```bash
# 1. ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
mkdir -p customer-service/src/main/java/org/springframework/samples/petclinic/customer/{model,db,controller,service}
mkdir -p customer-service/src/main/resources/{templates/owners,templates/pets,templates/fragments}

# 2. Model íŒŒì¼ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/model/{BaseEntity,NamedEntity,Person,Owner,Pet,PetType}.java \
   customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/

# 3. Repository íŒŒì¼ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/db/{Owner,Pet}Repository.java \
   customer-service/src/main/java/org/springframework/samples/petclinic/customer/db/

# 4. Controller íŒŒì¼ ë³µì‚¬  
cp monolith/src/main/java/org/springframework/samples/petclinic/controller/{Owner,Pet}Controller.java \
   customer-service/src/main/java/org/springframework/samples/petclinic/customer/controller/
cp monolith/src/main/java/org/springframework/samples/petclinic/controller/PetForm.java \
   customer-service/src/main/java/org/springframework/samples/petclinic/customer/controller/

# 5. Service íŒŒì¼ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/service/PetFormValidator.java \
   customer-service/src/main/java/org/springframework/samples/petclinic/customer/service/

# 6. Template íŒŒì¼ ë³µì‚¬
cp -r monolith/src/main/resources/templates/owners/* customer-service/src/main/resources/templates/owners/
cp -r monolith/src/main/resources/templates/pets/* customer-service/src/main/resources/templates/pets/  
cp -r monolith/src/main/resources/templates/fragments/* customer-service/src/main/resources/templates/fragments/
```

### Step 3: ìƒˆ íŒŒì¼ ìƒì„±

#### 1. build.gradle
```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.18'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'org.springframework.samples'
version = '1.0.0'
sourceCompatibility = '17'
targetCompatibility = '17'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    runtimeOnly 'com.h2database:h2'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

tasks.named('test') {
    useJUnitPlatform()
}
```

#### 2. application.yml  
```yaml
server:
  port: 8081

spring:
  application:
    name: customer-service
    
  thymeleaf:
    cache: false
    
  datasource:
    url: jdbc:h2:mem:customerdb
    driver-class-name: org.h2.Driver
    username: sa
    password:
    
  h2:
    console:
      enabled: true
      
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
```

#### 3. CustomerServiceApplication.java
```java
package org.springframework.samples.petclinic.customer;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class CustomerServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CustomerServiceApplication.class, args);
    }
}
```

#### 4. CustomerService.java (ClinicServiceì—ì„œ Customer ë¶€ë¶„ë§Œ ë¶„ë¦¬)
```java
package org.springframework.samples.petclinic.customer.service;

import org.springframework.samples.petclinic.customer.db.OwnerRepository;
import org.springframework.samples.petclinic.customer.db.PetRepository;
import org.springframework.samples.petclinic.customer.model.Owner;
import org.springframework.samples.petclinic.customer.model.Pet;
import org.springframework.samples.petclinic.customer.model.PetType;
import org.springframework.stereotype.Service;

import java.util.Collection;
import java.util.List;

@Service
public class CustomerService {

    private final OwnerRepository owners;
    private final PetRepository pets;

    public CustomerService(OwnerRepository owners, PetRepository pets) {
        this.owners = owners;
        this.pets = pets;
    }

    // OwnerControllerì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œë“¤ (ê¸°ë³¸)
    public Collection<Owner> ownerByLastName(String lastName) {
        return owners.findByLastName(lastName);
    }

    public Owner ownerById(int ownerId) {
        return owners.findById(ownerId);
    }

    public void save(Owner owner) {
        owners.save(owner);
    }

    // í˜¸í™˜ì„±ì„ ìœ„í•œ ê¸°ì¡´ ë©”ì„œë“œëª… ìœ ì§€
    public Collection<Owner> findOwnersByLastName(String lastName) {
        return ownerByLastName(lastName);
    }

    public Owner findOwnerById(int ownerId) {
        return ownerById(ownerId);
    }

    public void saveOwner(Owner owner) {
        save(owner);
    }

    // Pet ê´€ë ¨ ë©”ì„œë“œë“¤ (PetController í˜¸í™˜ì„± í¬í•¨)
    public Pet findPetById(int petId) {
        return pets.findById(petId);
    }
    
    public Pet petById(int petId) {
        return pets.findById(petId);
    }

    public List<PetType> findPetTypes() {
        return pets.findPetTypes();
    }
    
    public Collection<PetType> petTypes() {
        return pets.findPetTypes();
    }

    public void savePet(Pet pet) {
        pets.save(pet);
    }
    
    public void save(Pet pet) {
        pets.save(pet);
    }
    
    // TODO: API Gateway ë‹¨ê³„ì—ì„œ Feature Flagë¥¼ í†µí•´ Visit ì„œë¹„ìŠ¤ ì—°ë™ ì˜ˆì •
    // í˜„ì¬ëŠ” ì„ì‹œë¡œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (Visit ì„œë¹„ìŠ¤ ë¶„ë¦¬ í›„ ìˆ˜ì •)
    public List<?> visitsByPetId(int petId) {
        // Feature Flagë¡œ ëª¨ë†€ë¦¬ìŠ¤ Visit API í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½ ì˜ˆì •
        return new java.util.ArrayList<>();
    }
}
```

### âš ï¸ Visit ê´€ë ¨ ì„ì‹œ ì²˜ë¦¬ ì•ˆë‚´

**í˜„ì¬ ë‹¨ê³„ì—ì„œëŠ” Visit ê´€ë ¨ ê¸°ëŠ¥ì„ ì„ì‹œë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤:**

1. **Pet ëª¨ë¸**: Visit ì°¸ì¡° ë¶€ë¶„ì„ ì„ì‹œ êµ¬í˜„ìœ¼ë¡œ ë³€ê²½
2. **CustomerService**: `visitsByPetId()` ë©”ì„œë“œê°€ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
3. **í–¥í›„ ê³„íš**: API Gateway ë‹¨ê³„ì—ì„œ Feature Flagë¥¼ í†µí•´ ì ì§„ì ìœ¼ë¡œ Visit ì„œë¹„ìŠ¤ì™€ ì—°ë™

**ì´ë ‡ê²Œ ì²˜ë¦¬í•œ ì´ìœ :**
- ì‹¤ë¬´ì—ì„œëŠ” ì„œë¹„ìŠ¤ ë¶„ë¦¬ ì‹œ **ê¸°ì¡´ ê¸°ëŠ¥ì„ ë‹¨ê³„ì ìœ¼ë¡œ ì´ì „**
- Visitì€ Owner/Petê³¼ëŠ” ë‹¤ë¥¸ ë„ë©”ì¸ì´ë¯€ë¡œ ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬ ì˜ˆì •
- API Gatewayì—ì„œ **Feature Flag íŒ¨í„´**ì„ í†µí•´ ì•ˆì „í•œ ì „í™˜ êµ¬í˜„

**ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ìˆ˜ì •í•  ë¶€ë¶„:**
```java
// API Gateway ì„¤ì • í›„ ìˆ˜ì • ì˜ˆì •
@Value("${feature.visit.useNewService:false}")
private boolean useNewVisitService;

public List<Visit> visitsByPetId(int petId) {
    return useNewVisitService ? 
        visitServiceClient.getVisits(petId) :  // ìƒˆë¡œìš´ Visit ì„œë¹„ìŠ¤
        monolithClient.getVisits(petId);       // ê¸°ì¡´ ëª¨ë†€ë¦¬ìŠ¤
}
```

### Step 4: íŒ¨í‚¤ì§€ ê²½ë¡œ ë° Import ë¬¸ ìˆ˜ì • (...petclinic.[].[] -> ...petclinic.custormer.[].[])

#### 4-1. ê¸°ë³¸ íŒ¨í‚¤ì§€ ê²½ë¡œ ë³€ê²½
ë³µì‚¬í•œ ëª¨ë“  Java íŒŒì¼ì—ì„œ íŒ¨í‚¤ì§€ ê²½ë¡œë¥¼ ìˆ˜ì •:

```bash
# Person.java
import org.springframework.samples.petclinic.customer.model.BaseEntity;

# Pet.java  
import org.springframework.samples.petclinic.customer.model.NamedEntity;
import org.springframework.samples.petclinic.customer.model.Owner;
import org.springframework.samples.petclinic.customer.model.PetType;

# PetType.java
import org.springframework.samples.petclinic.customer.model.NamedEntity;

# PetForm.java
import org.springframework.samples.petclinic.customer.model.Owner;

# PetFormValidator.java  
import org.springframework.samples.petclinic.customer.controller.PetForm;
```

#### 4-2. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ë³€ê²½
**OwnerController.java:**
```java
// ë³€ê²½ ì „
private final ClinicService service;
public OwnerController(ClinicService service) { ... }

// ë³€ê²½ í›„  
private final CustomerService service;
public OwnerController(CustomerService service) { ... }
```

**PetController.java:**
```java
// ë³€ê²½ ì „
import org.springframework.samples.petclinic.service.ClinicService;
private final ClinicService service;

// ë³€ê²½ í›„
import org.springframework.samples.petclinic.customer.service.CustomerService;
private final CustomerService service;

// ë©”ì„œë“œ í˜¸ì¶œë„ ìˆ˜ì •
this.service.findPetTypes() // ëŒ€ì‹  this.service.petTypes() ì‚¬ìš©
```

#### 4-3. Pet ëª¨ë¸ì—ì„œ Visit ê´€ë ¨ ì„ì‹œ ì²˜ë¦¬
**Pet.javaì—ì„œ Visit ê´€ë ¨ ë¶€ë¶„ ìˆ˜ì •:**
```java
// ê¸°ì¡´ Visit í•„ë“œ ì œê±°í•˜ê³  ì„ì‹œ ë©”ì„œë“œë¡œ ëŒ€ì²´
public void setVisitsInternal(Collection<?> visits) {
    // ì„ì‹œ êµ¬í˜„ - í˜„ì¬ëŠ” ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
}

public List<?> getVisits() {
    // TODO: Feature Flagë¡œ Visit ì„œë¹„ìŠ¤ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì • ì˜ˆì •
    return new ArrayList<>();
}
```

#### â­ï¸ 4-4. settings.gradleì— customer-service ì¶”ê°€
```gradle
include 'activemq'
include 'monolith'
include 'customer-service'  // ì¶”ê°€
```

#### 4-5. ë¦¬ì†ŒìŠ¤ íŒŒì¼ ì¶”ê°€ ë³µì‚¬
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸° ë°ì´í„° ë³µì‚¬
mkdir -p customer-service/src/main/resources/db  
cp monolith/src/main/resources/db/data.sql customer-service/src/main/resources/db/
```

### Step 5: ì»´íŒŒì¼ ë° ì‹¤í–‰ í…ŒìŠ¤íŠ¸

#### 5-1. ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸
```bash
# ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ customer-service ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸
./gradlew customer-service:compileJava

# ì„±ê³µí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ ì¶œë ¥:
# BUILD SUCCESSFUL in 2s
```

#### 5-2. ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

```bash
# 1. Monolith ì‹¤í–‰ (ê¸°ì¡´) - ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
./gradlew monolith:bootRun
# â†’ http://localhost:8080

# 2. Customer Service ì‹¤í–‰ (ìƒˆë¡œìš´) - ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
./gradlew customer-service:bootRun
# â†’ http://localhost:8081
```

**í…ŒìŠ¤íŠ¸:**
1. `http://localhost:8080` - ê¸°ì¡´ ëª¨ë†€ë¦¬ìŠ¤ (ì „ì²´ ê¸°ëŠ¥)
2. `http://localhost:8081` - Customer Service (Owner/Petë§Œ)

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Customer Serviceê°€ 8081 í¬íŠ¸ì—ì„œ ë…ë¦½ ì‹¤í–‰ë¨
- [ ] Owner ê´€ë¦¬ ê¸°ëŠ¥ì´ ì •ìƒ ë™ì‘í•¨
- [ ] Pet ê´€ë¦¬ ê¸°ëŠ¥ì´ ì •ìƒ ë™ì‘í•¨  
- [ ] Thymeleaf UIê°€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ í‘œì‹œë¨
- [ ] ë³„ë„ H2 ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©í•¨
- [ ] ê¸°ì¡´ ëª¨ë†€ë¦¬ìŠ¤(8080)ë„ ì •ìƒ ë™ì‘í•¨

---

## ğŸ¯ í•µì‹¬ ì„±ê³¼

1. **ì„œë¹„ìŠ¤ ë¶„ë¦¬ ì™„ë£Œ**: Owner&Pet ë„ë©”ì¸ì„ ë…ë¦½ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬
2. **UI ìœ ì§€**: ë³µì¡í•œ API ë³€í™˜ ì—†ì´ ê¸°ì¡´ Thymeleaf í…œí”Œë¦¿ ê·¸ëŒ€ë¡œ ì‚¬ìš©
3. **ë…ë¦½ ì‹¤í–‰**: ì„œë¡œ ë‹¤ë¥¸ í¬íŠ¸, ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë…ë¦½ ìš´ì˜
4. **ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜**: ê¸°ì¡´ ëª¨ë†€ë¦¬ìŠ¤ë¥¼ ìœ ì§€í•˜ë©´ì„œ ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€

** ğŸ‰ ì•„ê¸°ì‚¬ìë“¤ì˜ ì²«ë²ˆì§¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬ë¥¼ ì¶•í•˜í•©ë‹ˆë‹¤~~ **