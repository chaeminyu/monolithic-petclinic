# Pet Clinic ì„œë¹„ìŠ¤ ë¶„ë¦¬ ì‹¤ìŠµ ê°€ì´ë“œ
## Owner&Pet, Vet ì„œë¹„ìŠ¤ ë¶„ë¦¬ì™€ API Gateway êµ¬í˜„

---

## ğŸ“‹ ì‹¤ìŠµ ê°œìš”

### ëª©í‘œ
ëª¨ë†€ë¦¬ì‹ Pet Clinicì„ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ ì ì§„ì ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.
- **Phase 1**: Owner&Pet ì„œë¹„ìŠ¤ ë¶„ë¦¬ (25ë¶„)
- **Phase 2**: Vet ì„œë¹„ìŠ¤ ë¶„ë¦¬ (15ë¶„)
- **Phase 3**: API Gateway êµ¬í˜„ (15ë¶„)
- **Phase 4**: í†µí•© í…ŒìŠ¤íŠ¸ (15ë¶„)

### ìµœì¢… ì•„í‚¤í…ì²˜

```
Before (ëª¨ë†€ë¦¬ì‹):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Monolithic Pet Clinic         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Owner â”‚  â”‚ Vet  â”‚  â”‚Visit â”‚  â”‚
â”‚  â”‚ Pet  â”‚  â”‚      â”‚  â”‚      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         Single Database         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (í•˜ì´ë¸Œë¦¬ë“œ MSA):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer Svc   â”‚  â”‚   Vet Svc      â”‚  â”‚  Monolith      â”‚
â”‚ (Owner + Pet)  â”‚  â”‚                â”‚  â”‚  (Visit)       â”‚
â”‚   Port: 8081   â”‚  â”‚   Port: 8082   â”‚  â”‚  Port: 8080    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Gateway   â”‚
                    â”‚   Port: 8090    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                        [Clients]
```

---

## ğŸš€ Phase 1: Owner&Pet ì„œë¹„ìŠ¤ ë¶„ë¦¬

### Step 1.1: í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡° íŒŒì•…

í˜„ì¬ monolith êµ¬ì¡°:
```
monolith/src/main/java/org/springframework/samples/petclinic/
â”œâ”€â”€ Application.java              # Main í´ë˜ìŠ¤
â”œâ”€â”€ controller/                   # Web Controllers (Thymeleaf)
â”‚   â”œâ”€â”€ OwnerController.java     # Owner ê´€ë¦¬
â”‚   â”œâ”€â”€ PetController.java       # Pet ê´€ë¦¬
â”‚   â”œâ”€â”€ PetForm.java            # Pet Form DTO
â”‚   â”œâ”€â”€ VetController.java       # Vet ê´€ë¦¬
â”‚   â””â”€â”€ VisitController.java     # Visit ê´€ë¦¬
â”œâ”€â”€ db/                          # Repository ê³„ì¸µ
â”‚   â”œâ”€â”€ OwnerRepository.java     # Owner JPA Repository
â”‚   â”œâ”€â”€ PetRepository.java       # Pet JPA Repository
â”‚   â”œâ”€â”€ VetRepository.java       # Vet JPA Repository
â”‚   â””â”€â”€ VisitRepository.java     # Visit JPA Repository
â”œâ”€â”€ model/                       # JPA Entity
â”‚   â”œâ”€â”€ BaseEntity.java          # ê³µí†µ Base Entity
â”‚   â”œâ”€â”€ NamedEntity.java         # Named Entity
â”‚   â”œâ”€â”€ Person.java              # Person Base
â”‚   â”œâ”€â”€ Owner.java               # Owner Entity
â”‚   â”œâ”€â”€ Pet.java                 # Pet Entity
â”‚   â”œâ”€â”€ PetType.java            # Pet Type Entity
â”‚   â”œâ”€â”€ Vet.java                 # Vet Entity
â”‚   â””â”€â”€ Visit.java               # Visit Entity
â””â”€â”€ service/
    â”œâ”€â”€ ClinicService.java       # í†µí•© ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    â””â”€â”€ PetFormValidator.java    # Pet Form ê²€ì¦
```

#### ë¶„ë¦¬í•  Customer Service êµ¬ì¡°
```
customer-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ org/springframework/samples/petclinic/customer/
â”‚   â”‚   â”‚       â”œâ”€â”€ CustomerServiceApplication.java    # ìƒˆ Main í´ë˜ìŠ¤
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ OwnerController.java          # Thymeleaf ê·¸ëŒ€ë¡œ ìœ ì§€
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ PetController.java            # Thymeleaf ê·¸ëŒ€ë¡œ ìœ ì§€
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ PetForm.java                  # Form DTO ê·¸ëŒ€ë¡œ ì‚¬ìš©
â”‚   â”‚   â”‚       â”œâ”€â”€ service/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ CustomerService.java          # ClinicServiceì—ì„œ Customer ë¡œì§ ë¶„ë¦¬
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ PetFormValidator.java         # ê¸°ì¡´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
â”‚   â”‚   â”‚       â”œâ”€â”€ db/                               # ê¸°ì¡´ package êµ¬ì¡° ìœ ì§€
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ OwnerRepository.java          # ë³µì‚¬
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ PetRepository.java            # ë³µì‚¬
â”‚   â”‚   â”‚       â””â”€â”€ model/
â”‚   â”‚   â”‚           â”œâ”€â”€ BaseEntity.java               # ë³µì‚¬ (ê³µí†µ Base)
â”‚   â”‚   â”‚           â”œâ”€â”€ NamedEntity.java              # ë³µì‚¬ (ê³µí†µ)
â”‚   â”‚   â”‚           â”œâ”€â”€ Person.java                   # ë³µì‚¬ (Owner ìƒì†)
â”‚   â”‚   â”‚           â”œâ”€â”€ Owner.java                    # ë³µì‚¬ (ì£¼ìš” Entity)
â”‚   â”‚   â”‚           â”œâ”€â”€ Pet.java                      # ë³µì‚¬ (ì£¼ìš” Entity)
â”‚   â”‚   â”‚           â””â”€â”€ PetType.java                  # ë³µì‚¬ (Pet íƒ€ì…)
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ templates/                            # Thymeleaf í…œí”Œë¦¿ ë³µì‚¬
â”‚   â”‚       â”‚   â”œâ”€â”€ owners/                          # Owner ê´€ë ¨ í…œí”Œë¦¿ë“¤
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ createOrUpdateOwnerForm.html
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ findOwners.html
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ownerDetails.html
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ownersList.html
â”‚   â”‚       â”‚   â””â”€â”€ pets/                            # Pet ê´€ë ¨ í…œí”Œë¦¿ë“¤
â”‚   â”‚       â”‚       â””â”€â”€ createOrUpdatePetForm.html
â”‚   â”‚       â”œâ”€â”€ application.yml                       # ìƒˆ í¬íŠ¸(8081), DB ì„¤ì •
â”‚   â”‚       â””â”€â”€ data.sql                              # Owner/Pet ì´ˆê¸° ë°ì´í„°
â””â”€â”€ build.gradle                                      # ìƒˆ ì˜ì¡´ì„± ì„¤ì •
```

### Step 1.2: íŒŒì¼ ë³µì‚¬ ë° ìƒì„± ê³„íš

#### ë³µì‚¬í•  íŒŒì¼ ëª©ë¡ (monolith â†’ customer-service)
```bash
# Model ê³„ì¸µ (JPA Entity) - ëª¨ë“  Customer ê´€ë ¨ Entity
monolith/src/main/java/org/springframework/samples/petclinic/model/BaseEntity.java
monolith/src/main/java/org/springframework/samples/petclinic/model/NamedEntity.java  
monolith/src/main/java/org/springframework/samples/petclinic/model/Person.java
monolith/src/main/java/org/springframework/samples/petclinic/model/Owner.java
monolith/src/main/java/org/springframework/samples/petclinic/model/Pet.java
monolith/src/main/java/org/springframework/samples/petclinic/model/PetType.java

# Repository ê³„ì¸µ
monolith/src/main/java/org/springframework/samples/petclinic/db/OwnerRepository.java
monolith/src/main/java/org/springframework/samples/petclinic/db/PetRepository.java

# Controller ê³„ì¸µ (Thymeleaf ê·¸ëŒ€ë¡œ ìœ ì§€, íŒ¨í‚¤ì§€ë§Œ ìˆ˜ì •)
monolith/src/main/java/org/springframework/samples/petclinic/controller/OwnerController.java
monolith/src/main/java/org/springframework/samples/petclinic/controller/PetController.java
monolith/src/main/java/org/springframework/samples/petclinic/controller/PetForm.java

# Service ê³„ì¸µ
monolith/src/main/java/org/springframework/samples/petclinic/service/PetFormValidator.java

# Thymeleaf í…œí”Œë¦¿ íŒŒì¼ë“¤
monolith/src/main/resources/templates/owners/createOrUpdateOwnerForm.html
monolith/src/main/resources/templates/owners/findOwners.html  
monolith/src/main/resources/templates/owners/ownerDetails.html
monolith/src/main/resources/templates/owners/ownersList.html
monolith/src/main/resources/templates/pets/createOrUpdatePetForm.html
```

#### ìƒˆë¡œ ìƒì„±í•  íŒŒì¼ ëª©ë¡
```bash
# Main Application í´ë˜ìŠ¤
customer-service/src/main/java/org/springframework/samples/petclinic/customer/CustomerServiceApplication.java

# ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ClinicServiceì—ì„œ Customer ê´€ë ¨ ë©”ì„œë“œë§Œ ë¶„ë¦¬)
customer-service/src/main/java/org/springframework/samples/petclinic/customer/service/CustomerService.java

# ì„¤ì • íŒŒì¼
customer-service/build.gradle
customer-service/src/main/resources/application.yml
customer-service/src/main/resources/data.sql

# ê¸°íƒ€ ì„¤ì • íŒŒì¼ (í•„ìš”ì‹œ)
customer-service/settings.gradle
```

#### ìˆ˜ì •í•´ì•¼ í•  ë¶€ë¶„ë“¤
1. **Package ë³€ê²½**: `org.springframework.samples.petclinic` â†’ `org.springframework.samples.petclinic.customer`
2. **Import ìˆ˜ì •**: ë³€ê²½ëœ íŒ¨í‚¤ì§€ ê²½ë¡œì— ë§ê²Œ import ë¬¸ ìˆ˜ì •
3. **Port ì„¤ì •**: 8080 â†’ 8081 (ì„œë¡œ ë‹¤ë¥¸ í¬íŠ¸ì—ì„œ ë…ë¦½ ì‹¤í–‰)
4. **DB ì„¤ì •**: ë³„ë„ H2 ë©”ëª¨ë¦¬ DB (customerdb)
5. **Controller ìˆ˜ì •**: ClinicService â†’ CustomerService ì˜ì¡´ì„± ë³€ê²½
6. **Build ì„¤ì •**: Spring Boot Web, Thymeleaf ì˜ì¡´ì„± í¬í•¨

### Step 1.3: build.gradle ì„¤ì •

```gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.18'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.petclinic'
version = '1.0.0'
sourceCompatibility = '17'

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot Web (ê¸°ë³¸)
    implementation 'org.springframework.boot:spring-boot-starter-web'
    
    // Thymeleaf í…œí”Œë¦¿ ì—”ì§„ (ê¸°ì¡´ UI ìœ ì§€)
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    
    // Spring Boot Data JPA (ë°ì´í„° ì•¡ì„¸ìŠ¤)
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    
    // H2 Database (ì¸ë©”ëª¨ë¦¬ DB)
    runtimeOnly 'com.h2database:h2'
    
    // Validation (Form ê²€ì¦)
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    
    // Actuator (ëª¨ë‹ˆí„°ë§)
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    
    // Test
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

tasks.named('test') {
    useJUnitPlatform()
}

bootJar {
    mainClass = 'com.petclinic.customer.CustomerServiceApplication'
}
```

### Step 1.3: CustomerService êµ¬í˜„ (ClinicServiceì—ì„œ ë¶„ë¦¬)

#### CustomerService.java
```java
package org.springframework.samples.petclinic.customer.service;

import org.springframework.samples.petclinic.customer.db.OwnerRepository;
import org.springframework.samples.petclinic.customer.db.PetRepository;
import org.springframework.samples.petclinic.customer.model.Owner;
import org.springframework.samples.petclinic.customer.model.Pet;
import org.springframework.samples.petclinic.customer.model.PetType;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Collection;
import java.util.List;

@Service
@Transactional
public class CustomerService {

    private final OwnerRepository ownerRepository;
    private final PetRepository petRepository;

    public CustomerService(OwnerRepository ownerRepository, PetRepository petRepository) {
        this.ownerRepository = ownerRepository;
        this.petRepository = petRepository;
    }

    // Owner ê´€ë ¨ ë©”ì„œë“œë“¤
    public Collection<Owner> findOwnersByLastName(String lastName) {
        return ownerRepository.findByLastName(lastName);
    }

    public Owner findOwnerById(int ownerId) {
        return ownerRepository.findById(ownerId);
    }

    public void saveOwner(Owner owner) {
        ownerRepository.save(owner);
    }

    // Pet ê´€ë ¨ ë©”ì„œë“œë“¤
    public Pet findPetById(int petId) {
        return petRepository.findById(petId);
    }

    public List<PetType> findPetTypes() {
        return petRepository.findPetTypes();
    }

    public void savePet(Pet pet) {
        petRepository.save(pet);
    }

    // ì¶”ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í•„ìš”ì‹œ)
    public List<Owner> findAllOwners() {
        return ownerRepository.findAll();
    }

    public List<Pet> findPetsByOwner(Owner owner) {
        return petRepository.findByOwner(owner);
    }
}
```

### Step 1.4: ì‹¤ì œ íŒŒì¼ ë³µì‚¬ ì‘ì—…

ì´ì œ ì‹¤ì œë¡œ monolithì—ì„œ customer-serviceë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ëŠ” ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤.

#### ë³µì‚¬ ì‘ì—… ìˆœì„œ
1. **ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±**
2. **Model íŒŒì¼ ë³µì‚¬** (Entity í´ë˜ìŠ¤ë“¤)  
3. **Repository íŒŒì¼ ë³µì‚¬** (ë°ì´í„° ì•¡ì„¸ìŠ¤)
4. **Controller íŒŒì¼ ë³µì‚¬** (ì›¹ ì»¨íŠ¸ë¡¤ëŸ¬)
5. **Service íŒŒì¼ ë³µì‚¬** (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
6. **Template íŒŒì¼ ë³µì‚¬** (Thymeleaf í…œí”Œë¦¿)
7. **ìƒˆ íŒŒì¼ ìƒì„±** (Application, ì„¤ì •íŒŒì¼)

#### 1ë‹¨ê³„: ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
```bash
mkdir -p customer-service/src/main/java/org/springframework/samples/petclinic/customer/{model,db,controller,service}
mkdir -p customer-service/src/main/resources/{templates/owners,templates/pets,templates/fragments}
```

#### 2ë‹¨ê³„: Model íŒŒì¼ ë³µì‚¬ 
```bash
# ê¸°ë³¸ Entity í´ë˜ìŠ¤ë“¤ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/model/BaseEntity.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/
cp monolith/src/main/java/org/springframework/samples/petclinic/model/NamedEntity.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/
cp monolith/src/main/java/org/springframework/samples/petclinic/model/Person.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/

# Customer ê´€ë ¨ Entity ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/model/Owner.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/
cp monolith/src/main/java/org/springframework/samples/petclinic/model/Pet.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/
cp monolith/src/main/java/org/springframework/samples/petclinic/model/PetType.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/model/
```

#### 3ë‹¨ê³„: Repository íŒŒì¼ ë³µì‚¬
```bash
# Repository ì¸í„°í˜ì´ìŠ¤ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/db/OwnerRepository.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/db/
cp monolith/src/main/java/org/springframework/samples/petclinic/db/PetRepository.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/db/
```

#### 4ë‹¨ê³„: Controller íŒŒì¼ ë³µì‚¬
```bash
# Web Controller ë³µì‚¬ (Thymeleaf ê¸°ë°˜)
cp monolith/src/main/java/org/springframework/samples/petclinic/controller/OwnerController.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/controller/
cp monolith/src/main/java/org/springframework/samples/petclinic/controller/PetController.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/controller/
cp monolith/src/main/java/org/springframework/samples/petclinic/controller/PetForm.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/controller/
```

#### 5ë‹¨ê³„: Service íŒŒì¼ ë³µì‚¬
```bash
# Service í´ë˜ìŠ¤ ë³µì‚¬
cp monolith/src/main/java/org/springframework/samples/petclinic/service/PetFormValidator.java customer-service/src/main/java/org/springframework/samples/petclinic/customer/service/
```

#### 6ë‹¨ê³„: Template íŒŒì¼ ë³µì‚¬
```bash
# Thymeleaf í…œí”Œë¦¿ íŒŒì¼ë“¤ ë³µì‚¬
cp monolith/src/main/resources/templates/owners/*.html customer-service/src/main/resources/templates/owners/
cp monolith/src/main/resources/templates/pets/*.html customer-service/src/main/resources/templates/pets/
cp monolith/src/main/resources/templates/fragments/*.html customer-service/src/main/resources/templates/fragments/
```

### Step 1.5: íŒŒì¼ ìˆ˜ì • ì‘ì—…

ì´ì œ ë³µì‚¬í•œ íŒŒì¼ë“¤ì˜ íŒ¨í‚¤ì§€ ê²½ë¡œì™€ ì˜ì¡´ì„±ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

#### ì£¼ìš” ìˆ˜ì • ì‚¬í•­
```java
package com.petclinic.customer.service;

import com.petclinic.customer.dto.OwnerDTO;
import com.petclinic.customer.dto.CreateOwnerRequest;
import com.petclinic.customer.model.Owner;
import com.petclinic.customer.repository.OwnerRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
@Transactional
@RequiredArgsConstructor
@Slf4j
public class OwnerService {
    
    private final OwnerRepository ownerRepository;
    
    // Owner ìƒì„±
    public OwnerDTO createOwner(CreateOwnerRequest request) {
        log.info("Creating new owner: {}", request.getFirstName());
        
        Owner owner = new Owner();
        owner.setFirstName(request.getFirstName());
        owner.setLastName(request.getLastName());
        owner.setAddress(request.getAddress());
        owner.setCity(request.getCity());
        owner.setTelephone(request.getTelephone());
        
        Owner saved = ownerRepository.save(owner);
        return convertToDTO(saved);
    }
    
    // Owner ì¡°íšŒ (Pets í¬í•¨)
    @Transactional(readOnly = true)
    public OwnerDTO findOwnerById(Long id) {
        log.info("Finding owner by id: {}", id);
        
        return ownerRepository.findByIdWithPets(id)
            .map(this::convertToDTO)
            .orElseThrow(() -> new RuntimeException("Owner not found: " + id));
    }
    
    // ëª¨ë“  Owner ì¡°íšŒ
    @Transactional(readOnly = true)
    public List<OwnerDTO> findAllOwners() {
        log.info("Finding all owners");
        
        return ownerRepository.findAll().stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList());
    }
    
    // ì´ë¦„ìœ¼ë¡œ Owner ê²€ìƒ‰
    @Transactional(readOnly = true)
    public List<OwnerDTO> searchOwnersByLastName(String lastName) {
        log.info("Searching owners by last name: {}", lastName);
        
        return ownerRepository.findByLastNameContainingIgnoreCase(lastName)
            .stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList());
    }
    
    // Owner ìˆ˜ì •
    public OwnerDTO updateOwner(Long id, CreateOwnerRequest request) {
        log.info("Updating owner: {}", id);
        
        Owner owner = ownerRepository.findById(id)
            .orElseThrow(() -> new RuntimeException("Owner not found: " + id));
        
        owner.setFirstName(request.getFirstName());
        owner.setLastName(request.getLastName());
        owner.setAddress(request.getAddress());
        owner.setCity(request.getCity());
        owner.setTelephone(request.getTelephone());
        
        Owner updated = ownerRepository.save(owner);
        return convertToDTO(updated);
    }
    
    // Owner ì‚­ì œ
    public void deleteOwner(Long id) {
        log.info("Deleting owner: {}", id);
        
        if (!ownerRepository.existsById(id)) {
            throw new RuntimeException("Owner not found: " + id);
        }
        
        ownerRepository.deleteById(id);
    }
    
    // Entity â†’ DTO ë³€í™˜
    private OwnerDTO convertToDTO(Owner owner) {
        OwnerDTO dto = new OwnerDTO();
        dto.setId(owner.getId());
        dto.setFirstName(owner.getFirstName());
        dto.setLastName(owner.getLastName());
        dto.setAddress(owner.getAddress());
        dto.setCity(owner.getCity());
        dto.setTelephone(owner.getTelephone());
        dto.setPetCount(owner.getPets().size());
        
        return dto;
    }
}
```

#### PetService.java
```java
package com.petclinic.customer.service;

import com.petclinic.customer.dto.PetDTO;
import com.petclinic.customer.dto.CreatePetRequest;
import com.petclinic.customer.model.Owner;
import com.petclinic.customer.model.Pet;
import com.petclinic.customer.repository.OwnerRepository;
import com.petclinic.customer.repository.PetRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
@Transactional
@RequiredArgsConstructor
@Slf4j
public class PetService {
    
    private final PetRepository petRepository;
    private final OwnerRepository ownerRepository;
    
    // Pet ìƒì„±
    public PetDTO createPet(Long ownerId, CreatePetRequest request) {
        log.info("Creating new pet for owner: {}", ownerId);
        
        Owner owner = ownerRepository.findById(ownerId)
            .orElseThrow(() -> new RuntimeException("Owner not found: " + ownerId));
        
        Pet pet = new Pet();
        pet.setName(request.getName());
        pet.setBirthDate(request.getBirthDate());
        pet.setType(request.getType());
        
        owner.addPet(pet);
        Pet saved = petRepository.save(pet);
        
        return convertToDTO(saved);
    }
    
    // Pet ì¡°íšŒ
    @Transactional(readOnly = true)
    public PetDTO findPetById(Long id) {
        log.info("Finding pet by id: {}", id);
        
        return petRepository.findByIdWithOwner(id)
            .map(this::convertToDTO)
            .orElseThrow(() -> new RuntimeException("Pet not found: " + id));
    }
    
    // Ownerì˜ ëª¨ë“  Pet ì¡°íšŒ
    @Transactional(readOnly = true)
    public List<PetDTO> findPetsByOwnerId(Long ownerId) {
        log.info("Finding pets for owner: {}", ownerId);
        
        return petRepository.findByOwnerId(ownerId)
            .stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList());
    }
    
    // Pet ìˆ˜ì •
    public PetDTO updatePet(Long id, CreatePetRequest request) {
        log.info("Updating pet: {}", id);
        
        Pet pet = petRepository.findById(id)
            .orElseThrow(() -> new RuntimeException("Pet not found: " + id));
        
        pet.setName(request.getName());
        pet.setBirthDate(request.getBirthDate());
        pet.setType(request.getType());
        
        Pet updated = petRepository.save(pet);
        return convertToDTO(updated);
    }
    
    // Pet ì‚­ì œ
    public void deletePet(Long id) {
        log.info("Deleting pet: {}", id);
        
        Pet pet = petRepository.findByIdWithOwner(id)
            .orElseThrow(() -> new RuntimeException("Pet not found: " + id));
        
        Owner owner = pet.getOwner();
        owner.removePet(pet);
        petRepository.delete(pet);
    }
    
    // Entity â†’ DTO ë³€í™˜
    private PetDTO convertToDTO(Pet pet) {
        PetDTO dto = new PetDTO();
        dto.setId(pet.getId());
        dto.setName(pet.getName());
        dto.setBirthDate(pet.getBirthDate());
        dto.setType(pet.getType());
        dto.setAge(pet.getAge());
        
        if (pet.getOwner() != null) {
            dto.setOwnerId(pet.getOwner().getId());
            dto.setOwnerName(pet.getOwner().getFullName());
        }
        
        return dto;
    }
}
```

### Step 1.6: Controller Layer

#### OwnerController.java
```java
package com.petclinic.customer.controller;

import com.petclinic.customer.dto.OwnerDTO;
import com.petclinic.customer.dto.CreateOwnerRequest;
import com.petclinic.customer.service.OwnerService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/customers/owners")
@RequiredArgsConstructor
@Slf4j
@CrossOrigin(origins = "*") // ê°œë°œ í™˜ê²½ìš©
public class OwnerController {
    
    private final OwnerService ownerService;
    
    // Owner ìƒì„±
    @PostMapping
    public ResponseEntity<OwnerDTO> createOwner(@Valid @RequestBody CreateOwnerRequest request) {
        log.info("Creating owner: {}", request);
        OwnerDTO created = ownerService.createOwner(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    // Owner ë‹¨ê±´ ì¡°íšŒ
    @GetMapping("/{id}")
    public ResponseEntity<OwnerDTO> getOwner(@PathVariable Long id) {
        log.info("Getting owner: {}", id);
        OwnerDTO owner = ownerService.findOwnerById(id);
        return ResponseEntity.ok(owner);
    }
    
    // ëª¨ë“  Owner ì¡°íšŒ
    @GetMapping
    public ResponseEntity<List<OwnerDTO>> getAllOwners() {
        log.info("Getting all owners");
        List<OwnerDTO> owners = ownerService.findAllOwners();
        return ResponseEntity.ok(owners);
    }
    
    // ì´ë¦„ìœ¼ë¡œ Owner ê²€ìƒ‰
    @GetMapping("/search")
    public ResponseEntity<List<OwnerDTO>> searchOwners(@RequestParam String lastName) {
        log.info("Searching owners by lastName: {}", lastName);
        List<OwnerDTO> owners = ownerService.searchOwnersByLastName(lastName);
        return ResponseEntity.ok(owners);
    }
    
    // Owner ìˆ˜ì •
    @PutMapping("/{id}")
    public ResponseEntity<OwnerDTO> updateOwner(
            @PathVariable Long id, 
            @Valid @RequestBody CreateOwnerRequest request) {
        log.info("Updating owner: {}", id);
        OwnerDTO updated = ownerService.updateOwner(id, request);
        return ResponseEntity.ok(updated);
    }
    
    // Owner ì‚­ì œ
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteOwner(@PathVariable Long id) {
        log.info("Deleting owner: {}", id);
        ownerService.deleteOwner(id);
        return ResponseEntity.noContent().build();
    }
    
    // Health Check
    @GetMapping("/health")
    public ResponseEntity<String> health() {
        return ResponseEntity.ok("Owner Service is running!");
    }
}
```

#### PetController.java
```java
package com.petclinic.customer.controller;

import com.petclinic.customer.dto.PetDTO;
import com.petclinic.customer.dto.CreatePetRequest;
import com.petclinic.customer.service.PetService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/customers")
@RequiredArgsConstructor
@Slf4j
@CrossOrigin(origins = "*")
public class PetController {
    
    private final PetService petService;
    
    // Pet ìƒì„±
    @PostMapping("/owners/{ownerId}/pets")
    public ResponseEntity<PetDTO> createPet(
            @PathVariable Long ownerId,
            @Valid @RequestBody CreatePetRequest request) {
        log.info("Creating pet for owner: {}", ownerId);
        PetDTO created = petService.createPet(ownerId, request);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    // Pet ë‹¨ê±´ ì¡°íšŒ
    @GetMapping("/pets/{id}")
    public ResponseEntity<PetDTO> getPet(@PathVariable Long id) {
        log.info("Getting pet: {}", id);
        PetDTO pet = petService.findPetById(id);
        return ResponseEntity.ok(pet);
    }
    
    // Ownerì˜ ëª¨ë“  Pet ì¡°íšŒ
    @GetMapping("/owners/{ownerId}/pets")
    public ResponseEntity<List<PetDTO>> getOwnerPets(@PathVariable Long ownerId) {
        log.info("Getting pets for owner: {}", ownerId);
        List<PetDTO> pets = petService.findPetsByOwnerId(ownerId);
        return ResponseEntity.ok(pets);
    }
    
    // Pet ìˆ˜ì •
    @PutMapping("/pets/{id}")
    public ResponseEntity<PetDTO> updatePet(
            @PathVariable Long id,
            @Valid @RequestBody CreatePetRequest request) {
        log.info("Updating pet: {}", id);
        PetDTO updated = petService.updatePet(id, request);
        return ResponseEntity.ok(updated);
    }
    
    // Pet ì‚­ì œ
    @DeleteMapping("/pets/{id}")
    public ResponseEntity<Void> deletePet(@PathVariable Long id) {
        log.info("Deleting pet: {}", id);
        petService.deletePet(id);
        return ResponseEntity.noContent().build();
    }
}
```

### Step 1.7: DTO Classes

#### OwnerDTO.java
```java
package com.petclinic.customer.dto;

import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class OwnerDTO {
    private Long id;
    private String firstName;
    private String lastName;
    private String address;
    private String city;
    private String telephone;
    private Integer petCount;
}
```

#### PetDTO.java
```java
package com.petclinic.customer.dto;

import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

import java.time.LocalDate;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class PetDTO {
    private Long id;
    private String name;
    private LocalDate birthDate;
    private String type;
    private Integer age;
    private Long ownerId;
    private String ownerName;
}
```

#### CreateOwnerRequest.java
```java
package com.petclinic.customer.dto;

import jakarta.validation.constraints.NotEmpty;
import lombok.Data;

@Data
public class CreateOwnerRequest {
    @NotEmpty
    private String firstName;
    
    @NotEmpty
    private String lastName;
    
    @NotEmpty
    private String address;
    
    @NotEmpty
    private String city;
    
    @NotEmpty
    private String telephone;
}
```

#### CreatePetRequest.java
```java
package com.petclinic.customer.dto;

import jakarta.validation.constraints.NotEmpty;
import lombok.Data;

import java.time.LocalDate;

@Data
public class CreatePetRequest {
    @NotEmpty
    private String name;
    
    private LocalDate birthDate;
    
    @NotEmpty
    private String type;
}
```

### Step 1.8: Application Configuration

#### application.yml
```yaml
server:
  port: 8081
  servlet:
    context-path: /

spring:
  application:
    name: customer-service
    
  # Thymeleaf í…œí”Œë¦¿ ì„¤ì • (ê¸°ì¡´ UI ìœ ì§€)
  thymeleaf:
    cache: false
    prefix: classpath:/templates/
    suffix: .html
    
  datasource:
    url: jdbc:h2:mem:customerdb
    driver-class-name: org.h2.Driver
    username: sa
    password:
    
  h2:
    console:
      enabled: true
      path: /h2-console
      
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        
  sql:
    init:
      mode: always
      data-locations: classpath:data.sql

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always

logging:
  level:
    root: INFO
    org.springframework.samples.petclinic.customer: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
```

#### data.sql (ì´ˆê¸° ë°ì´í„°)
```sql
-- Sample Owners
INSERT INTO owners (first_name, last_name, address, city, telephone) VALUES
('George', 'Franklin', '110 W. Liberty St.', 'Madison', '6085551023'),
('Betty', 'Davis', '638 Cardinal Ave.', 'Sun Prairie', '6085551749'),
('Eduardo', 'Rodriquez', '2693 Commerce St.', 'McFarland', '6085558763'),
('Harold', 'Davis', '563 Friendly St.', 'Windsor', '6085553198');

-- Sample Pets
INSERT INTO pets (name, birth_date, type, owner_id) VALUES
('Leo', '2020-09-07', 'cat', 1),
('Basil', '2021-08-06', 'hamster', 2),
('Rosy', '2019-04-17', 'dog', 3),
('Jewel', '2020-03-07', 'dog', 3),
('Iggy', '2020-11-30', 'lizard', 4);
```

#### CustomerServiceApplication.java
```java
package org.springframework.samples.petclinic.customer;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * Customer Service - Ownerì™€ Pet ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
 * 
 * ê¸°ì¡´ ëª¨ë†€ë¦¬ì‹ Pet Clinicì—ì„œ ë¶„ë¦¬ëœ ì²« ë²ˆì§¸ ì„œë¹„ìŠ¤
 * - Port: 8081
 * - Database: H2 (customerdb)
 * - UI: Thymeleaf (ê¸°ì¡´ê³¼ ë™ì¼)
 */
@SpringBootApplication
public class CustomerServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CustomerServiceApplication.class, args);
    }
}
```

---

## ğŸš€ Phase 2: Vet ì„œë¹„ìŠ¤ ë¶„ë¦¬

### Step 2.1: í”„ë¡œì íŠ¸ êµ¬ì¡°

```
vet-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/petclinic/vet/
â”‚   â”‚   â”‚       â”œâ”€â”€ VetServiceApplication.java
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ VetController.java
â”‚   â”‚   â”‚       â”œâ”€â”€ service/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ VetService.java
â”‚   â”‚   â”‚       â”œâ”€â”€ repository/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ VetRepository.java
â”‚   â”‚   â”‚       â”œâ”€â”€ model/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ Vet.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ Specialty.java
â”‚   â”‚   â”‚       â””â”€â”€ dto/
â”‚   â”‚   â”‚           â”œâ”€â”€ VetDTO.java
â”‚   â”‚   â”‚           â””â”€â”€ CreateVetRequest.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â””â”€â”€ data.sql
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

### Step 2.2: ë„ë©”ì¸ ëª¨ë¸

#### Vet.java
```java
package com.petclinic.vet.model;

import jakarta.persistence.*;
import jakarta.validation.constraints.NotEmpty;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

import java.util.HashSet;
import java.util.Set;

@Entity
@Table(name = "vets")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Vet {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "first_name")
    @NotEmpty
    private String firstName;
    
    @Column(name = "last_name")
    @NotEmpty
    private String lastName;
    
    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
        name = "vet_specialties",
        joinColumns = @JoinColumn(name = "vet_id"),
        inverseJoinColumns = @JoinColumn(name = "specialty_id")
    )
    private Set<Specialty> specialties = new HashSet<>();
    
    // Helper methods
    public void addSpecialty(Specialty specialty) {
        specialties.add(specialty);
    }
    
    public void removeSpecialty(Specialty specialty) {
        specialties.remove(specialty);
    }
    
    public String getFullName() {
        return firstName + " " + lastName;
    }
}
```

#### Specialty.java
```java
package com.petclinic.vet.model;

import jakarta.persistence.*;
import jakarta.validation.constraints.NotEmpty;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.AllArgsConstructor;

@Entity
@Table(name = "specialties")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Specialty {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "name")
    @NotEmpty
    private String name;
}
```

### Step 2.3: Service & Repository

#### VetService.java
```java
package com.petclinic.vet.service;

import com.petclinic.vet.dto.VetDTO;
import com.petclinic.vet.dto.CreateVetRequest;
import com.petclinic.vet.model.Vet;
import com.petclinic.vet.model.Specialty;
import com.petclinic.vet.repository.VetRepository;
import com.petclinic.vet.repository.SpecialtyRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Service
@Transactional
@RequiredArgsConstructor
@Slf4j
public class VetService {
    
    private final VetRepository vetRepository;
    private final SpecialtyRepository specialtyRepository;
    
    // Vet ìƒì„±
    public VetDTO createVet(CreateVetRequest request) {
        log.info("Creating new vet: {}", request.getFirstName());
        
        Vet vet = new Vet();
        vet.setFirstName(request.getFirstName());
        vet.setLastName(request.getLastName());
        
        // ì „ë¬¸ ë¶„ì•¼ ì¶”ê°€
        if (request.getSpecialtyIds() != null) {
            Set<Specialty> specialties = request.getSpecialtyIds().stream()
                .map(id -> specialtyRepository.findById(id)
                    .orElseThrow(() -> new RuntimeException("Specialty not found: " + id)))
                .collect(Collectors.toSet());
            vet.setSpecialties(specialties);
        }
        
        Vet saved = vetRepository.save(vet);
        return convertToDTO(saved);
    }
    
    // Vet ë‹¨ê±´ ì¡°íšŒ
    @Transactional(readOnly = true)
    public VetDTO findVetById(Long id) {
        log.info("Finding vet by id: {}", id);
        
        return vetRepository.findById(id)
            .map(this::convertToDTO)
            .orElseThrow(() -> new RuntimeException("Vet not found: " + id));
    }
    
    // ëª¨ë“  Vet ì¡°íšŒ
    @Transactional(readOnly = true)
    public List<VetDTO> findAllVets() {
        log.info("Finding all vets");
        
        return vetRepository.findAll().stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList());
    }
    
    // ì „ë¬¸ ë¶„ì•¼ë¡œ Vet ê²€ìƒ‰
    @Transactional(readOnly = true)
    public List<VetDTO> findVetsBySpecialty(String specialtyName) {
        log.info("Finding vets by specialty: {}", specialtyName);
        
        return vetRepository.findBySpecialtiesName(specialtyName).stream()
            .map(this::convertToDTO)
            .collect(Collectors.toList());
    }
    
    // Vet ìˆ˜ì •
    public VetDTO updateVet(Long id, CreateVetRequest request) {
        log.info("Updating vet: {}", id);
        
        Vet vet = vetRepository.findById(id)
            .orElseThrow(() -> new RuntimeException("Vet not found: " + id));
        
        vet.setFirstName(request.getFirstName());
        vet.setLastName(request.getLastName());
        
        // ì „ë¬¸ ë¶„ì•¼ ì—…ë°ì´íŠ¸
        if (request.getSpecialtyIds() != null) {
            vet.getSpecialties().clear();
            Set<Specialty> specialties = request.getSpecialtyIds().stream()
                .map(specId -> specialtyRepository.findById(specId)
                    .orElseThrow(() -> new RuntimeException("Specialty not found: " + specId)))
                .collect(Collectors.toSet());
            vet.setSpecialties(specialties);
        }
        
        Vet updated = vetRepository.save(vet);
        return convertToDTO(updated);
    }
    
    // Vet ì‚­ì œ
    public void deleteVet(Long id) {
        log.info("Deleting vet: {}", id);
        
        if (!vetRepository.existsById(id)) {
            throw new RuntimeException("Vet not found: " + id);
        }
        
        vetRepository.deleteById(id);
    }
    
    // Entity â†’ DTO ë³€í™˜
    private VetDTO convertToDTO(Vet vet) {
        VetDTO dto = new VetDTO();
        dto.setId(vet.getId());
        dto.setFirstName(vet.getFirstName());
        dto.setLastName(vet.getLastName());
        
        Set<String> specialtyNames = vet.getSpecialties().stream()
            .map(Specialty::getName)
            .collect(Collectors.toSet());
        dto.setSpecialties(specialtyNames);
        
        return dto;
    }
}
```

### Step 2.4: Controller

#### VetController.java
```java
package com.petclinic.vet.controller;

import com.petclinic.vet.dto.VetDTO;
import com.petclinic.vet.dto.CreateVetRequest;
import com.petclinic.vet.service.VetService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/vets")
@RequiredArgsConstructor
@Slf4j
@CrossOrigin(origins = "*")
public class VetController {
    
    private final VetService vetService;
    
    // Vet ìƒì„±
    @PostMapping
    public ResponseEntity<VetDTO> createVet(@Valid @RequestBody CreateVetRequest request) {
        log.info("Creating vet: {}", request);
        VetDTO created = vetService.createVet(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    // Vet ë‹¨ê±´ ì¡°íšŒ
    @GetMapping("/{id}")
    public ResponseEntity<VetDTO> getVet(@PathVariable Long id) {
        log.info("Getting vet: {}", id);
        VetDTO vet = vetService.findVetById(id);
        return ResponseEntity.ok(vet);
    }
    
    // ëª¨ë“  Vet ì¡°íšŒ
    @GetMapping
    public ResponseEntity<List<VetDTO>> getAllVets() {
        log.info("Getting all vets");
        List<VetDTO> vets = vetService.findAllVets();
        return ResponseEntity.ok(vets);
    }
    
    // ì „ë¬¸ ë¶„ì•¼ë¡œ Vet ê²€ìƒ‰
    @GetMapping("/search")
    public ResponseEntity<List<VetDTO>> searchVets(@RequestParam String specialty) {
        log.info("Searching vets by specialty: {}", specialty);
        List<VetDTO> vets = vetService.findVetsBySpecialty(specialty);
        return ResponseEntity.ok(vets);
    }
    
    // Vet ìˆ˜ì •
    @PutMapping("/{id}")
    public ResponseEntity<VetDTO> updateVet(
            @PathVariable Long id,
            @Valid @RequestBody CreateVetRequest request) {
        log.info("Updating vet: {}", id);
        VetDTO updated = vetService.updateVet(id, request);
        return ResponseEntity.ok(updated);
    }
    
    // Vet ì‚­ì œ
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteVet(@PathVariable Long id) {
        log.info("Deleting vet: {}", id);
        vetService.deleteVet(id);
        return ResponseEntity.noContent().build();
    }
    
    // Health Check
    @GetMapping("/health")
    public ResponseEntity<String> health() {
        return ResponseEntity.ok("Vet Service is running!");
    }
}
```

### Step 2.5: Configuration

#### application.yml (Vet Service)
```yaml
server:
  port: 8082

spring:
  application:
    name: vet-service
    
  datasource:
    url: jdbc:h2:mem:vetdb
    driver-class-name: org.h2.Driver
    username: sa
    password:
    
  h2:
    console:
      enabled: true
      path: /h2-console
      
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    
  sql:
    init:
      mode: always
      data-locations: classpath:data.sql

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics

logging:
  level:
    com.petclinic.vet: DEBUG
```

#### data.sql (Vet Service)
```sql
-- Specialties
INSERT INTO specialties (name) VALUES ('radiology');
INSERT INTO specialties (name) VALUES ('surgery');
INSERT INTO specialties (name) VALUES ('dentistry');

-- Vets
INSERT INTO vets (first_name, last_name) VALUES ('James', 'Carter');
INSERT INTO vets (first_name, last_name) VALUES ('Helen', 'Leary');
INSERT INTO vets (first_name, last_name) VALUES ('Linda', 'Douglas');

-- Vet Specialties
INSERT INTO vet_specialties VALUES (1, 1);
INSERT INTO vet_specialties VALUES (2, 1);
INSERT INTO vet_specialties VALUES (2, 2);
INSERT INTO vet_specialties VALUES (3, 2);
INSERT INTO vet_specialties VALUES (3, 3);
```

---

## ğŸš€ Phase 3: API Gateway êµ¬í˜„

### Step 3.1: í”„ë¡œì íŠ¸ êµ¬ì¡°

```
api-gateway/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/petclinic/gateway/
â”‚   â”‚   â”‚       â”œâ”€â”€ GatewayApplication.java
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ GatewayController.java
â”‚   â”‚   â”‚       â”œâ”€â”€ client/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ CustomerServiceClient.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ VetServiceClient.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ MonolithClient.java
â”‚   â”‚   â”‚       â”œâ”€â”€ config/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ RestClientConfig.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ CircuitBreakerConfig.java
â”‚   â”‚   â”‚       â””â”€â”€ dto/
â”‚   â”‚   â”‚           â””â”€â”€ (shared DTOs)
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.yml
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

### Step 3.2: pom.xml (API Gateway)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.petclinic</groupId>
    <artifactId>api-gateway</artifactId>
    <version>1.0.0</version>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.1.5</version>
    </parent>
    
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Circuit Breaker -->
        <dependency>
            <groupId>io.github.resilience4j</groupId>
            <artifactId>resilience4j-spring-boot3</artifactId>
            <version>2.1.0</version>
        </dependency>
        
        <!-- Monitoring -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
    </dependencies>
</project>
```

### Step 3.3: RestClient Configuration

#### RestClientConfig.java
```java
package com.petclinic.gateway.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestClient;

@Configuration
public class RestClientConfig {
    
    @Value("${services.customer.url}")
    private String customerServiceUrl;
    
    @Value("${services.vet.url}")
    private String vetServiceUrl;
    
    @Value("${services.monolith.url}")
    private String monolithUrl;
    
    @Bean
    public RestClient customerServiceClient() {
        return RestClient.builder()
            .baseUrl(customerServiceUrl)
            .defaultHeader("Content-Type", "application/json")
            .build();
    }
    
    @Bean
    public RestClient vetServiceClient() {
        return RestClient.builder()
            .baseUrl(vetServiceUrl)
            .defaultHeader("Content-Type", "application/json")
            .build();
    }
    
    @Bean
    public RestClient monolithClient() {
        return RestClient.builder()
            .baseUrl(monolithUrl)
            .defaultHeader("Content-Type", "application/json")
            .build();
    }
}
```

### Step 3.4: Service Clients

#### CustomerServiceClient.java
```java
package com.petclinic.gateway.client;

import com.petclinic.gateway.dto.OwnerDTO;
import com.petclinic.gateway.dto.PetDTO;
import io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestClient;

import java.util.Collections;
import java.util.List;

@Component
@RequiredArgsConstructor
@Slf4j
public class CustomerServiceClient {
    
    private final RestClient customerServiceClient;
    private final RestClient monolithClient; // Fallbackìš©
    
    // Owner ì¡°íšŒ (Circuit Breaker ì ìš©)
    @CircuitBreaker(name = "customer-service", fallbackMethod = "getOwnerFallback")
    public OwnerDTO getOwner(Long id) {
        log.info("Calling customer service for owner: {}", id);
        
        return customerServiceClient.get()
            .uri("/api/customers/owners/{id}", id)
            .retrieve()
            .body(OwnerDTO.class);
    }
    
    // Fallback: ëª¨ë†€ë¦¬ì‹ì—ì„œ ì¡°íšŒ
    public OwnerDTO getOwnerFallback(Long id, Exception e) {
        log.warn("Customer service failed, falling back to monolith: {}", e.getMessage());
        
        return monolithClient.get()
            .uri("/owners/{id}", id)
            .retrieve()
            .body(OwnerDTO.class);
    }
    
    // ëª¨ë“  Owner ì¡°íšŒ
    @CircuitBreaker(name = "customer-service", fallbackMethod = "getAllOwnersFallback")
    public List<OwnerDTO> getAllOwners() {
        log.info("Getting all owners from customer service");
        
        return customerServiceClient.get()
            .uri("/api/customers/owners")
            .retrieve()
            .body(new ParameterizedTypeReference<List<OwnerDTO>>() {});
    }
    
    // Fallback: ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    public List<OwnerDTO> getAllOwnersFallback(Exception e) {
        log.warn("Customer service failed: {}", e.getMessage());
        return Collections.emptyList();
    }
    
    // Pet ì¡°íšŒ
    @CircuitBreaker(name = "customer-service", fallbackMethod = "getPetFallback")
    public PetDTO getPet(Long id) {
        log.info("Calling customer service for pet: {}", id);
        
        return customerServiceClient.get()
            .uri("/api/customers/pets/{id}", id)
            .retrieve()
            .body(PetDTO.class);
    }
    
    public PetDTO getPetFallback(Long id, Exception e) {
        log.warn("Customer service failed for pet: {}", e.getMessage());
        
        return monolithClient.get()
            .uri("/pets/{id}", id)
            .retrieve()
            .body(PetDTO.class);
    }
}
```

#### VetServiceClient.java
```java
package com.petclinic.gateway.client;

import com.petclinic.gateway.dto.VetDTO;
import io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestClient;

import java.util.Collections;
import java.util.List;

@Component
@RequiredArgsConstructor
@Slf4j
public class VetServiceClient {
    
    private final RestClient vetServiceClient;
    private final RestClient monolithClient;
    
    // Vet ì¡°íšŒ
    @CircuitBreaker(name = "vet-service", fallbackMethod = "getVetFallback")
    public VetDTO getVet(Long id) {
        log.info("Calling vet service for vet: {}", id);
        
        return vetServiceClient.get()
            .uri("/api/vets/{id}", id)
            .retrieve()
            .body(VetDTO.class);
    }
    
    // Fallback: ëª¨ë†€ë¦¬ì‹ì—ì„œ ì¡°íšŒ
    public VetDTO getVetFallback(Long id, Exception e) {
        log.warn("Vet service failed, falling back to monolith: {}", e.getMessage());
        
        return monolithClient.get()
            .uri("/vets/{id}", id)
            .retrieve()
            .body(VetDTO.class);
    }
    
    // ëª¨ë“  Vet ì¡°íšŒ
    @CircuitBreaker(name = "vet-service", fallbackMethod = "getAllVetsFallback")
    public List<VetDTO> getAllVets() {
        log.info("Getting all vets from vet service");
        
        return vetServiceClient.get()
            .uri("/api/vets")
            .retrieve()
            .body(new ParameterizedTypeReference<List<VetDTO>>() {});
    }
    
    public List<VetDTO> getAllVetsFallback(Exception e) {
        log.warn("Vet service failed: {}", e.getMessage());
        return Collections.emptyList();
    }
}
```

### Step 3.5: Gateway Controller

#### GatewayController.java
```java
package com.petclinic.gateway.controller;

import com.petclinic.gateway.client.CustomerServiceClient;
import com.petclinic.gateway.client.VetServiceClient;
import com.petclinic.gateway.client.MonolithClient;
import com.petclinic.gateway.dto.*;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
@Slf4j
@CrossOrigin(origins = "*")
public class GatewayController {
    
    private final CustomerServiceClient customerClient;
    private final VetServiceClient vetClient;
    private final MonolithClient monolithClient;
    
    @Value("${feature.toggle.use-customer-service}")
    private boolean useCustomerService;
    
    @Value("${feature.toggle.use-vet-service}")
    private boolean useVetService;
    
    // ======= Owner Endpoints =======
    
    @GetMapping("/owners/{id}")
    public ResponseEntity<OwnerDTO> getOwner(@PathVariable Long id) {
        log.info("Gateway: Getting owner {}", id);
        
        if (useCustomerService) {
            // ìƒˆë¡œìš´ Customer Service ì‚¬ìš©
            return ResponseEntity.ok(customerClient.getOwner(id));
        } else {
            // ê¸°ì¡´ Monolith ì‚¬ìš©
            return ResponseEntity.ok(monolithClient.getOwner(id));
        }
    }
    
    @GetMapping("/owners")
    public ResponseEntity<List<OwnerDTO>> getAllOwners() {
        log.info("Gateway: Getting all owners");
        
        if (useCustomerService) {
            return ResponseEntity.ok(customerClient.getAllOwners());
        } else {
            return ResponseEntity.ok(monolithClient.getAllOwners());
        }
    }
    
    // ======= Pet Endpoints =======
    
    @GetMapping("/pets/{id}")
    public ResponseEntity<PetDTO> getPet(@PathVariable Long id) {
        log.info("Gateway: Getting pet {}", id);
        
        if (useCustomerService) {
            return ResponseEntity.ok(customerClient.getPet(id));
        } else {
            return ResponseEntity.ok(monolithClient.getPet(id));
        }
    }
    
    // ======= Vet Endpoints =======
    
    @GetMapping("/vets/{id}")
    public ResponseEntity<VetDTO> getVet(@PathVariable Long id) {
        log.info("Gateway: Getting vet {}", id);
        
        if (useVetService) {
            return ResponseEntity.ok(vetClient.getVet(id));
        } else {
            return ResponseEntity.ok(monolithClient.getVet(id));
        }
    }
    
    @GetMapping("/vets")
    public ResponseEntity<List<VetDTO>> getAllVets() {
        log.info("Gateway: Getting all vets");
        
        if (useVetService) {
            return ResponseEntity.ok(vetClient.getAllVets());
        } else {
            return ResponseEntity.ok(monolithClient.getAllVets());
        }
    }
    
    // ======= Visit Endpoints (ì•„ì§ Monolithì— ìˆìŒ) =======
    
    @GetMapping("/visits/{id}")
    public ResponseEntity<VisitDTO> getVisit(@PathVariable Long id) {
        log.info("Gateway: Getting visit {} from monolith", id);
        return ResponseEntity.ok(monolithClient.getVisit(id));
    }
    
    @GetMapping("/visits")
    public ResponseEntity<List<VisitDTO>> getAllVisits() {
        log.info("Gateway: Getting all visits from monolith");
        return ResponseEntity.ok(monolithClient.getAllVisits());
    }
    
    // ======= Health & Status Endpoints =======
    
    @GetMapping("/health")
    public ResponseEntity<Map<String, Object>> health() {
        Map<String, Object> status = new HashMap<>();
        status.put("gateway", "UP");
        status.put("customerService", useCustomerService ? "ACTIVE" : "INACTIVE");
        status.put("vetService", useVetService ? "ACTIVE" : "INACTIVE");
        status.put("monolith", "ACTIVE");
        
        return ResponseEntity.ok(status);
    }
    
    @GetMapping("/architecture")
    public ResponseEntity<Map<String, String>> getArchitecture() {
        Map<String, String> architecture = new HashMap<>();
        architecture.put("type", "Hybrid (Strangler Pattern)");
        architecture.put("customerService", useCustomerService ? "Microservice" : "Monolith");
        architecture.put("vetService", useVetService ? "Microservice" : "Monolith");
        architecture.put("visitService", "Monolith");
        
        return ResponseEntity.ok(architecture);
    }
}
```

### Step 3.6: Configuration

#### application.yml (API Gateway)
```yaml
server:
  port: 8090

spring:
  application:
    name: api-gateway

# Service URLs
services:
  customer:
    url: http://localhost:8081
  vet:
    url: http://localhost:8082
  monolith:
    url: http://localhost:8080

# Feature Toggles
feature:
  toggle:
    use-customer-service: true  # true = MSA, false = Monolith
    use-vet-service: true       # true = MSA, false = Monolith

# Circuit Breaker Configuration
resilience4j:
  circuitbreaker:
    instances:
      customer-service:
        register-health-indicator: true
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10000
        permitted-number-of-calls-in-half-open-state: 3
        automatic-transition-from-open-to-half-open-enabled: true
        
      vet-service:
        register-health-indicator: true
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10000
        permitted-number-of-calls-in-half-open-state: 3
        automatic-transition-from-open-to-half-open-enabled: true

# Logging
logging:
  level:
    com.petclinic.gateway: DEBUG
    io.github.resilience4j: DEBUG

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,circuitbreakers
  endpoint:
    health:
      show-details: always
```

---

## ğŸš€ Phase 4: ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### Step 4.1: ì„œë¹„ìŠ¤ ì‹¤í–‰

```bash
# Terminal 1: Monolith (ê¸°ì¡´ ì„œë¹„ìŠ¤)
cd monolith
./gradlew :monolith:bootRun
# â†’ http://localhost:8080

# Terminal 2: Customer Service
cd customer-service
./gradlew bootRun
# â†’ http://localhost:8081

# Terminal 3: Vet Service
cd vet-service
./gradlew bootRun
# â†’ http://localhost:8082

# Terminal 4: API Gateway
cd api-gateway
./gradlew bootRun
# â†’ http://localhost:8090
```

### Step 4.2: í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### 1. Health Check
```bash
# ê° ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
curl http://localhost:8081/api/customers/owners/health
curl http://localhost:8082/api/vets/health
curl http://localhost:8090/api/health

# Expected Response (Gateway):
{
  "gateway": "UP",
  "customerService": "ACTIVE",
  "vetService": "ACTIVE",
  "monolith": "ACTIVE"
}
```

#### 2. Owner ì¡°íšŒ (MSA)
```bash
# Gatewayë¥¼ í†µí•œ Owner ì¡°íšŒ
curl http://localhost:8090/api/owners/1

# ì§ì ‘ Customer Service í˜¸ì¶œ
curl http://localhost:8081/api/customers/owners/1

# ì‘ë‹µ ë¹„êµ â†’ ê°™ì•„ì•¼ í•¨!
```

#### 3. Vet ì¡°íšŒ (MSA)
```bash
# Gatewayë¥¼ í†µí•œ Vet ì¡°íšŒ
curl http://localhost:8090/api/vets

# ì§ì ‘ Vet Service í˜¸ì¶œ
curl http://localhost:8082/api/vets

# ì‘ë‹µ ë¹„êµ â†’ ê°™ì•„ì•¼ í•¨!
```

#### 4. Visit ì¡°íšŒ (ì•„ì§ Monolith)
```bash
# Gatewayë¥¼ í†µí•œ Visit ì¡°íšŒ
curl http://localhost:8090/api/visits

# ì§ì ‘ Monolith í˜¸ì¶œ
curl http://localhost:8080/visits

# ì‘ë‹µ ë¹„êµ â†’ ê°™ì•„ì•¼ í•¨!
```

#### 5. Circuit Breaker í…ŒìŠ¤íŠ¸
```bash
# 1. Customer Service ì¤‘ì§€ (Terminal 2ì—ì„œ Ctrl+C)

# 2. Owner ì¡°íšŒ ì‹œë„
curl http://localhost:8090/api/owners/1
# â†’ Fallbackìœ¼ë¡œ Monolithì—ì„œ ì‘ë‹µ!

# 3. Customer Service ì¬ì‹œì‘
cd customer-service
mvn spring-boot:run

# 4. ë‹¤ì‹œ ì¡°íšŒ
curl http://localhost:8090/api/owners/1
# â†’ Customer Serviceì—ì„œ ì‘ë‹µ!
```

### Step 4.3: ì•„í‚¤í…ì²˜ í™•ì¸

```bash
curl http://localhost:8090/api/architecture

# Expected Response:
{
  "type": "Hybrid (Strangler Pattern)",
  "customerService": "Microservice",
  "vetService": "Microservice",
  "visitService": "Monolith"
}
```

---

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸ ì •ë¦¬

### ë‹¬ì„±í•œ ê²ƒ
1. **Owner&Pet ì„œë¹„ìŠ¤ ë¶„ë¦¬** âœ…
   - ë…ë¦½ì ì¸ Customer Service
   - ìì²´ ë°ì´í„°ë² ì´ìŠ¤
   - RESTful API

2. **Vet ì„œë¹„ìŠ¤ ë¶„ë¦¬** âœ…
   - ë…ë¦½ì ì¸ Vet Service
   - ì „ë¬¸ ë¶„ì•¼ ê´€ë¦¬
   - ë…ë¦½ ë°°í¬ ê°€ëŠ¥

3. **API Gateway êµ¬í˜„** âœ…
   - Strangler Pattern êµ¬í˜„
   - Feature Toggle
   - Circuit Breaker (Resilience)
   - Fallback ì „ëµ

4. **í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜** âœ…
   - MSAì™€ Monolith ê³µì¡´
   - ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
   - ë¬´ì¤‘ë‹¨ ì „í™˜

### ë‚¨ì€ ì‘ì—… (ê³¼ì œ)
1. **Visit Service ë¶„ë¦¬**
   - Owner/Pet/Vet ì°¸ì¡° ì²˜ë¦¬
   - ë¶„ì‚° íŠ¸ëœì­ì…˜
   - ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 

2. **ë°ì´í„°ë² ì´ìŠ¤ ë¶„ë¦¬**
   - í˜„ì¬: Shared H2 (In-Memory)
   - ëª©í‘œ: ê° ì„œë¹„ìŠ¤ë³„ ë…ë¦½ DB

3. **ë©”ì‹œì§€ í ë„ì…**
   - ë¹„ë™ê¸° í†µì‹ 
   - ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜

4. **ëª¨ë‹ˆí„°ë§ & ë¡œê¹…**
   - ë¶„ì‚° ì¶”ì  (Sleuth + Zipkin)
   - ì¤‘ì•™ ë¡œê¹… (ELK Stack)

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ë¬¸ì œ 1: í¬íŠ¸ ì¶©ëŒ
```bash
# ì¦ìƒ
Web server failed to start. Port 8081 was already in use.

# í•´ê²°
lsof -i :8081
kill -9 <PID>

# ë˜ëŠ” application.ymlì—ì„œ í¬íŠ¸ ë³€ê²½
server:
  port: 8083
```

### ë¬¸ì œ 2: Connection Refused
```bash
# ì¦ìƒ
Connection refused: localhost/127.0.0.1:8081

# ì›ì¸
Customer Serviceê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

# í•´ê²°
1. ì„œë¹„ìŠ¤ ì‹¤í–‰ í™•ì¸
2. Circuit Breakerê°€ Fallback ì²˜ë¦¬
```

### ë¬¸ì œ 3: ë°ì´í„° ë¶ˆì¼ì¹˜
```bash
# ì¦ìƒ
Ownerê°€ MSAì—ëŠ” ìˆëŠ”ë° Monolithì—ëŠ” ì—†ìŒ

# ì›ì¸
ê°ê° ë‹¤ë¥¸ DB ì‚¬ìš© (ì´ˆê¸° ë‹¨ê³„)

# í•´ê²° (ì„ì‹œ)
ë™ì¼í•œ ì´ˆê¸° ë°ì´í„° (data.sql) ì‚¬ìš©

# í•´ê²° (ì¥ê¸°)
ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ê¸°í™”
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê´€ë ¨ íŒ¨í„´
- [Strangler Fig Pattern](https://martinfowler.com/bliki/StranglerFigApplication.html)
- [Circuit Breaker Pattern](https://martinfowler.com/bliki/CircuitBreaker.html)
- [API Gateway Pattern](https://microservices.io/patterns/apigateway.html)

### Spring ë¬¸ì„œ
- [Spring Boot](https://spring.io/projects/spring-boot)
- [Spring Cloud](https://spring.io/projects/spring-cloud)
- [Resilience4j](https://resilience4j.readme.io/)

---

## ğŸ“ í•™ìŠµ ì„±ê³¼

ì´ ì‹¤ìŠµì„ ì™„ë£Œí•˜ë©´:

1. âœ… **Strangler Pattern ì‹¤ì „ ê²½í—˜**
2. âœ… **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ API ì„¤ê³„**
3. âœ… **Circuit Breaker êµ¬í˜„**
4. âœ… **API Gateway íŒ¨í„´ ì´í•´**
5. âœ… **ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ**
6. âœ… **Feature Toggle í™œìš©**

**ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰**

ëª¨ë†€ë¦¬ì‹ì—ì„œ MSAë¡œì˜ ì²« ê±¸ìŒì„ ì„±ê³µì ìœ¼ë¡œ ì™„ì„±í–ˆìŠµë‹ˆë‹¤!